<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gmail API Quickstart</title>
    <link rel="stylesheet" href="rstyles.css"> <!-- Link to the external CSS file -->
</head>
<body>
    <header>Admin Login</header>

    <!-- Add buttons to initiate auth sequence, sign out, and refresh -->
    <button id="authorize_button" onclick="handleAuthClick()">Authorize</button>
    <button id="signout_button" onclick="handleSignoutClick()">Sign Out</button>
    <button id="refresh_button" onclick="refreshMessages()">Refresh</button>

    <!-- Add filter boxes without input fields -->
    <div class="filter-container">
        <div class="filter-box">
            <label for="senderGmail">Messenger</label>
        </div>

        <div class="filter-box">
            <label for="sms">SMS:</label>
        </div>

        <div class="filter-box">
            <label for="gmailReceived">Gmail</label>
        </div>
    </div>

    <div id="content"></div>

    <script type="text/javascript">
        // Your existing script goes here

        /**
 * Refresh messages in the authorized user's inbox.
 */
async function refreshMessages() {
    // Clear the content area
    document.getElementById('content').innerText = '';

    // Fetch and display the latest messages
    await listMessages();
}

/**
 * Retrieve the list of messages from the user's Gmail inbox.
 */
async function listMessages() {
    try {
        const response = await gapi.client.gmail.users.messages.list({
            'userId': 'me',
            'labelIds': 'INBOX',
            'maxResults': 10, // You can adjust the number of messages to retrieve
        });

        const messages = response.result.messages;

        if (messages && messages.length > 0) {
            for (const message of messages) {
                // Fetch individual message details
                const messageDetails = await gapi.client.gmail.users.messages.get({
                    'userId': 'me',
                    'id': message.id,
                });

                // Extract sender's email address and subject
                const sender = messageDetails.result.payload.headers.find(header => header.name === 'From');
                const subject = messageDetails.result.payload.headers.find(header => header.name === 'Subject');

                // Display sender and subject in the content area
                document.getElementById('content').innerHTML += `<p><strong>Sender:</strong> ${sender.value}</p>`;
                document.getElementById('content').innerHTML += `<p><strong>Subject:</strong> ${subject.value}</p>`;
                document.getElementById('content').innerHTML += '<hr>';
            }
        } else {
            document.getElementById('content').innerText = 'No messages found.';
        }
    } catch (error) {
        console.error('Error fetching messages:', error);
    }
}
    </script>
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>
