<!DOCTYPE html>
<html>
  <head>
    <title>Gmail API Quickstart</title>
    <meta charset="utf-8" />
  </head>
  <body>
    <p>Gmail API Quickstart</p>

    <!-- Add buttons to initiate auth sequence and sign out -->
    <button id="authorize_button" onclick="handleAuthClick()">Authorize</button>
    <button id="signout_button" onclick="handleSignoutClick()">Sign Out</button>

    <div>
      <h3>SMS Box</h3>
      <div id="smsBox" style="white-space: pre-wrap;"></div>
    </div>

    <div>
      <h3>Messenger Box</h3>
      <div id="messengerBox" style="white-space: pre-wrap;"></div>
    </div>

    <div>
      <h3>Gmail Box</h3>
      <div id="gmailBox" style="white-space: pre-wrap;"></div>
    </div>

    <script type="text/javascript">
      /* exported gapiLoaded */
      /* exported gisLoaded */
      /* exported handleAuthClick */
      /* exported handleSignoutClick */

      // ... (your existing code)

      /**
       * Print messages in the authorized user's inbox and categorize them into different boxes.
       */
      async function listMessages() {
        let response;
        try {
          response = await gapi.client.gmail.users.messages.list({
            'userId': 'me',
            'maxResults': 10, // Adjust as needed
          });
        } catch (err) {
          document.getElementById('content').innerText = err.message;
          return;
        }
        const messages = response.result.messages;
        if (!messages || messages.length === 0) {
          document.getElementById('content').innerText = 'No messages found.';
          return;
        }

        // Clear existing content in boxes
        document.getElementById('smsBox').innerText = '';
        document.getElementById('messengerBox').innerText = '';
        document.getElementById('gmailBox').innerText = '';

        // Fetch and display message content
        for (const message of messages) {
          try {
            const messageDetails = await gapi.client.gmail.users.messages.get({
              'userId': 'me',
              'id': message.id,
            });

            const subject = messageDetails.result.payload.headers.find(header => header.name === 'Subject').value;
            const body = messageDetails.result.snippet;

            const messageText = `Subject: ${subject}\n${body}\n\n`;

            // Categorize messages based on the email receiver
            if (subject.includes('no-reply@sms-forwarder.com')) {
              document.getElementById('smsBox').innerText += messageText;
            } else if (subject.includes('yasmienjengayao@gmail.com')) {
              document.getElementById('messengerBox').innerText += messageText;
            } else {
              document.getElementById('gmailBox').innerText += messageText;
            }
          } catch (error) {
            console.error('Error fetching message details:', error);
          }
        }
      }
    </script>
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
  </body>
</html>
