<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gmail API Quickstart</title>
    <link rel="stylesheet" href="rstyles.css"> <!-- Link to the external CSS file -->
</head>
<body>
    <header>Admin Login</header>

    <!-- Add buttons to initiate auth sequence, sign out, and refresh -->
    <button id="authorize_button" onclick="handleAuthClick()">Authorize</button>
    <button id="signout_button" onclick="handleSignoutClick()">Sign Out</button>
    <button id="refresh_button" onclick="refreshMessages()">Refresh</button>

    <!-- Add filter boxes with input fields -->
    <div class="filter-container">
        <div class="filter-box">
            <label for="senderGmail">Messenger:</label>
            <input type="text" id="senderGmail" placeholder="Enter sender email">
        </div>

        <div class="filter-box">
            <label for="sms">SMS</label>
            <input type="text" id="sms" placeholder="no-reply@sms-forwarder.com">
        </div>

        <div class="filter-box">
            <label for="gmailReceived">Gmail:</label>
            <input type="text" id="gmailReceived" placeholder="Enter sender email">
        </div>
    </div>

    <div id="content"></div>

    <script type="text/javascript">
        // Your existing script goes here

        /**
         * Refresh messages in the authorized user's inbox.
         */
        async function refreshMessages() {
            // Clear the content area
            document.getElementById('content').innerText = '';

            // Fetch and display the latest messages
            const messages = await listMessages();

            // Filter and display messages based on criteria
            const senderGmail = document.getElementById('senderGmail').value.toLowerCase();
            const smsReceiver = document.getElementById('sms').value.toLowerCase();
            const gmailSender = document.getElementById('gmailReceived').value.toLowerCase();

            messages.forEach(message => {
                const sender = message.sender.toLowerCase();
                const receiver = message.receiver.toLowerCase();

                if (sender.includes(senderGmail)) {
                    displayMessage(message);
                } else if (receiver.includes(smsReceiver)) {
                    displayMessage(message);
                } else if (sender.includes(gmailSender)) {
                    displayMessage(message);
                }
            });
        }

        /**
         * Display a message in the content area.
         * Modify this function based on your message structure.
         */
        function displayMessage(message) {
            const contentDiv = document.getElementById('content');
            const messageDiv = document.createElement('div');
            messageDiv.innerText = `From: ${message.sender}, To: ${message.receiver}, Body: ${message.body}`;
            contentDiv.appendChild(messageDiv);
        }
    </script>
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>
